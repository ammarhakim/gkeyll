#include <gkyl_sheath_rarefaction_pot_kernels.h> 


GKYL_CU_DH void sheath_rarefaction_phi_mod_lower_3x_ser_p1(double elem_q, double mElc, const double *momsElc, double mIon, const double *momsIon, const double *phiWall, double *phi) 
{ 
  // elem_q: elementary charge.
  // mElc: electron mass.
  // momsElc: m0, m1, m2par (and m2perp, but not used) moments of electrons.
  // mIon: ion mass.
  // momsIon: m0, m1, m2par (and m2perp, but not used) moments of ions.
  // phi: electrostatic potential.

  double phiNodal[8];
  phiNodal[0] = -(1.837117307087383*phi[7])+1.060660171779821*phi[6]+1.060660171779821*phi[5]+1.060660171779821*phi[4]-0.6123724356957944*phi[3]-0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[1] = 1.837117307087383*phi[7]+1.060660171779821*phi[6]-1.060660171779821*phi[5]-1.060660171779821*phi[4]-0.6123724356957944*phi[3]-0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[2] = 1.837117307087383*phi[7]-1.060660171779821*phi[6]+1.060660171779821*phi[5]-1.060660171779821*phi[4]-0.6123724356957944*phi[3]+0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[3] = -(1.837117307087383*phi[7])-1.060660171779821*phi[6]-1.060660171779821*phi[5]+1.060660171779821*phi[4]-0.6123724356957944*phi[3]+0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[4] = 1.837117307087383*phi[7]-1.060660171779821*phi[6]-1.060660171779821*phi[5]+1.060660171779821*phi[4]+0.6123724356957944*phi[3]-0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[5] = -(1.837117307087383*phi[7])-1.060660171779821*phi[6]+1.060660171779821*phi[5]-1.060660171779821*phi[4]+0.6123724356957944*phi[3]-0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[6] = -(1.837117307087383*phi[7])+1.060660171779821*phi[6]-1.060660171779821*phi[5]-1.060660171779821*phi[4]+0.6123724356957944*phi[3]+0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[7] = 1.837117307087383*phi[7]+1.060660171779821*phi[6]+1.060660171779821*phi[5]+1.060660171779821*phi[4]+0.6123724356957944*phi[3]+0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 

  const double *m0Elc = &momsElc[0];
  const double *m0Ion = &momsIon[0];
  const double *m1Elc = &momsElc[8];
  const double *m1Ion = &momsIon[8];
  const double *m2parElc = &momsElc[16];
  const double *m2parIon = &momsIon[16];

  double m0eSurfNodal[4];
  double m0iSurfNodal[4];
  double m1eSurfNodal[4];
  double m1iSurfNodal[4];
  double m2pareSurfNodal[4];
  double m2pariSurfNodal[4];
  double phiWallNodal[4];
  m0eSurfNodal[0] = -(1.837117307087383*m0Elc[7])+1.060660171779821*m0Elc[6]+1.060660171779821*m0Elc[5]+1.060660171779821*m0Elc[4]-0.6123724356957944*m0Elc[3]-0.6123724356957944*m0Elc[2]-0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[1] = 1.837117307087383*m0Elc[7]+1.060660171779821*m0Elc[6]-1.060660171779821*m0Elc[5]-1.060660171779821*m0Elc[4]-0.6123724356957944*m0Elc[3]-0.6123724356957944*m0Elc[2]+0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[2] = 1.837117307087383*m0Elc[7]-1.060660171779821*m0Elc[6]+1.060660171779821*m0Elc[5]-1.060660171779821*m0Elc[4]-0.6123724356957944*m0Elc[3]+0.6123724356957944*m0Elc[2]-0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[3] = -(1.837117307087383*m0Elc[7])-1.060660171779821*m0Elc[6]-1.060660171779821*m0Elc[5]+1.060660171779821*m0Elc[4]-0.6123724356957944*m0Elc[3]+0.6123724356957944*m0Elc[2]+0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0iSurfNodal[0] = -(1.837117307087383*m0Ion[7])+1.060660171779821*m0Ion[6]+1.060660171779821*m0Ion[5]+1.060660171779821*m0Ion[4]-0.6123724356957944*m0Ion[3]-0.6123724356957944*m0Ion[2]-0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[1] = 1.837117307087383*m0Ion[7]+1.060660171779821*m0Ion[6]-1.060660171779821*m0Ion[5]-1.060660171779821*m0Ion[4]-0.6123724356957944*m0Ion[3]-0.6123724356957944*m0Ion[2]+0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[2] = 1.837117307087383*m0Ion[7]-1.060660171779821*m0Ion[6]+1.060660171779821*m0Ion[5]-1.060660171779821*m0Ion[4]-0.6123724356957944*m0Ion[3]+0.6123724356957944*m0Ion[2]-0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[3] = -(1.837117307087383*m0Ion[7])-1.060660171779821*m0Ion[6]-1.060660171779821*m0Ion[5]+1.060660171779821*m0Ion[4]-0.6123724356957944*m0Ion[3]+0.6123724356957944*m0Ion[2]+0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m1eSurfNodal[0] = -(1.837117307087383*m1Elc[7])+1.060660171779821*m1Elc[6]+1.060660171779821*m1Elc[5]+1.060660171779821*m1Elc[4]-0.6123724356957944*m1Elc[3]-0.6123724356957944*m1Elc[2]-0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[1] = 1.837117307087383*m1Elc[7]+1.060660171779821*m1Elc[6]-1.060660171779821*m1Elc[5]-1.060660171779821*m1Elc[4]-0.6123724356957944*m1Elc[3]-0.6123724356957944*m1Elc[2]+0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[2] = 1.837117307087383*m1Elc[7]-1.060660171779821*m1Elc[6]+1.060660171779821*m1Elc[5]-1.060660171779821*m1Elc[4]-0.6123724356957944*m1Elc[3]+0.6123724356957944*m1Elc[2]-0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[3] = -(1.837117307087383*m1Elc[7])-1.060660171779821*m1Elc[6]-1.060660171779821*m1Elc[5]+1.060660171779821*m1Elc[4]-0.6123724356957944*m1Elc[3]+0.6123724356957944*m1Elc[2]+0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1iSurfNodal[0] = -(1.837117307087383*m1Ion[7])+1.060660171779821*m1Ion[6]+1.060660171779821*m1Ion[5]+1.060660171779821*m1Ion[4]-0.6123724356957944*m1Ion[3]-0.6123724356957944*m1Ion[2]-0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[1] = 1.837117307087383*m1Ion[7]+1.060660171779821*m1Ion[6]-1.060660171779821*m1Ion[5]-1.060660171779821*m1Ion[4]-0.6123724356957944*m1Ion[3]-0.6123724356957944*m1Ion[2]+0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[2] = 1.837117307087383*m1Ion[7]-1.060660171779821*m1Ion[6]+1.060660171779821*m1Ion[5]-1.060660171779821*m1Ion[4]-0.6123724356957944*m1Ion[3]+0.6123724356957944*m1Ion[2]-0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[3] = -(1.837117307087383*m1Ion[7])-1.060660171779821*m1Ion[6]-1.060660171779821*m1Ion[5]+1.060660171779821*m1Ion[4]-0.6123724356957944*m1Ion[3]+0.6123724356957944*m1Ion[2]+0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m2pareSurfNodal[0] = -(1.837117307087383*m2parElc[7])+1.060660171779821*m2parElc[6]+1.060660171779821*m2parElc[5]+1.060660171779821*m2parElc[4]-0.6123724356957944*m2parElc[3]-0.6123724356957944*m2parElc[2]-0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[1] = 1.837117307087383*m2parElc[7]+1.060660171779821*m2parElc[6]-1.060660171779821*m2parElc[5]-1.060660171779821*m2parElc[4]-0.6123724356957944*m2parElc[3]-0.6123724356957944*m2parElc[2]+0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[2] = 1.837117307087383*m2parElc[7]-1.060660171779821*m2parElc[6]+1.060660171779821*m2parElc[5]-1.060660171779821*m2parElc[4]-0.6123724356957944*m2parElc[3]+0.6123724356957944*m2parElc[2]-0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[3] = -(1.837117307087383*m2parElc[7])-1.060660171779821*m2parElc[6]-1.060660171779821*m2parElc[5]+1.060660171779821*m2parElc[4]-0.6123724356957944*m2parElc[3]+0.6123724356957944*m2parElc[2]+0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pariSurfNodal[0] = -(1.837117307087383*m2parIon[7])+1.060660171779821*m2parIon[6]+1.060660171779821*m2parIon[5]+1.060660171779821*m2parIon[4]-0.6123724356957944*m2parIon[3]-0.6123724356957944*m2parIon[2]-0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[1] = 1.837117307087383*m2parIon[7]+1.060660171779821*m2parIon[6]-1.060660171779821*m2parIon[5]-1.060660171779821*m2parIon[4]-0.6123724356957944*m2parIon[3]-0.6123724356957944*m2parIon[2]+0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[2] = 1.837117307087383*m2parIon[7]-1.060660171779821*m2parIon[6]+1.060660171779821*m2parIon[5]-1.060660171779821*m2parIon[4]-0.6123724356957944*m2parIon[3]+0.6123724356957944*m2parIon[2]-0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[3] = -(1.837117307087383*m2parIon[7])-1.060660171779821*m2parIon[6]-1.060660171779821*m2parIon[5]+1.060660171779821*m2parIon[4]-0.6123724356957944*m2parIon[3]+0.6123724356957944*m2parIon[2]+0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  phiWallNodal[0] = 1.5*phiWall[3]-0.8660254037844386*phiWall[2]-0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[1] = -(1.5*phiWall[3])-0.8660254037844386*phiWall[2]+0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[2] = -(1.5*phiWall[3])+0.8660254037844386*phiWall[2]-0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[3] = 1.5*phiWall[3]+0.8660254037844386*phiWall[2]+0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 

  double upar_e = m1eSurfNodal[0]/m0eSurfNodal[0];
  double upar_i = m1iSurfNodal[0]/m0iSurfNodal[0];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[0]*mElc*upar_e-1.0*m2pareSurfNodal[0]*mElc))/m0eSurfNodal[0]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[0]*mIon*upar_i-1.0*m2pariSurfNodal[0]*mIon))/m0iSurfNodal[0]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 0;
  else
    Delta_phi_r = 0.0;

  phiNodal[0] = fmax(phiNodal[0] + Delta_phi_r, phi_wallNodal[0];

  double upar_e = m1eSurfNodal[1]/m0eSurfNodal[1];
  double upar_i = m1iSurfNodal[1]/m0iSurfNodal[1];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[1]*mElc*upar_e-1.0*m2pareSurfNodal[1]*mElc))/m0eSurfNodal[1]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[1]*mIon*upar_i-1.0*m2pariSurfNodal[1]*mIon))/m0iSurfNodal[1]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 1;
  else
    Delta_phi_r = 0.0;

  phiNodal[1] = fmax(phiNodal[1] + Delta_phi_r, phi_wallNodal[1];

  double upar_e = m1eSurfNodal[2]/m0eSurfNodal[2];
  double upar_i = m1iSurfNodal[2]/m0iSurfNodal[2];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[2]*mElc*upar_e-1.0*m2pareSurfNodal[2]*mElc))/m0eSurfNodal[2]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[2]*mIon*upar_i-1.0*m2pariSurfNodal[2]*mIon))/m0iSurfNodal[2]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 2;
  else
    Delta_phi_r = 0.0;

  phiNodal[2] = fmax(phiNodal[2] + Delta_phi_r, phi_wallNodal[2];

  double upar_e = m1eSurfNodal[3]/m0eSurfNodal[3];
  double upar_i = m1iSurfNodal[3]/m0iSurfNodal[3];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[3]*mElc*upar_e-1.0*m2pareSurfNodal[3]*mElc))/m0eSurfNodal[3]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[3]*mIon*upar_i-1.0*m2pariSurfNodal[3]*mIon))/m0iSurfNodal[3]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 3;
  else
    Delta_phi_r = 0.0;

  phiNodal[3] = fmax(phiNodal[3] + Delta_phi_r, phi_wallNodal[3];

  phi[0] = 0.3535533905932737*phiNodal[7]+0.3535533905932737*phiNodal[6]+0.3535533905932737*phiNodal[5]+0.3535533905932737*phiNodal[4]+0.3535533905932737*phiNodal[3]+0.3535533905932737*phiNodal[2]+0.3535533905932737*phiNodal[1]+0.3535533905932737*phiNodal[0]; 
  phi[1] = 0.20412414523193148*phiNodal[7]-0.20412414523193148*phiNodal[6]+0.20412414523193148*phiNodal[5]-0.20412414523193148*phiNodal[4]+0.20412414523193148*phiNodal[3]-0.20412414523193148*phiNodal[2]+0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[2] = 0.20412414523193148*phiNodal[7]+0.20412414523193148*phiNodal[6]-0.20412414523193148*phiNodal[5]-0.20412414523193148*phiNodal[4]+0.20412414523193148*phiNodal[3]+0.20412414523193148*phiNodal[2]-0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[3] = 0.20412414523193148*phiNodal[7]+0.20412414523193148*phiNodal[6]+0.20412414523193148*phiNodal[5]+0.20412414523193148*phiNodal[4]-0.20412414523193148*phiNodal[3]-0.20412414523193148*phiNodal[2]-0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[4] = 0.11785113019775789*phiNodal[7]-0.11785113019775789*phiNodal[6]-0.11785113019775789*phiNodal[5]+0.11785113019775789*phiNodal[4]+0.11785113019775789*phiNodal[3]-0.11785113019775789*phiNodal[2]-0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[5] = 0.11785113019775789*phiNodal[7]-0.11785113019775789*phiNodal[6]+0.11785113019775789*phiNodal[5]-0.11785113019775789*phiNodal[4]-0.11785113019775789*phiNodal[3]+0.11785113019775789*phiNodal[2]-0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[6] = 0.11785113019775789*phiNodal[7]+0.11785113019775789*phiNodal[6]-0.11785113019775789*phiNodal[5]-0.11785113019775789*phiNodal[4]-0.11785113019775789*phiNodal[3]-0.11785113019775789*phiNodal[2]+0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[7] = 0.06804138174397717*phiNodal[7]-0.06804138174397717*phiNodal[6]-0.06804138174397717*phiNodal[5]+0.06804138174397717*phiNodal[4]-0.06804138174397717*phiNodal[3]+0.06804138174397717*phiNodal[2]+0.06804138174397717*phiNodal[1]-0.06804138174397717*phiNodal[0]; 
 
}

GKYL_CU_DH void sheath_rarefaction_phi_mod_upper_3x_ser_p1(double elem_q, double mElc, const double *momsElc, double mIon, const double *momsIon, const double *phiWall, double *phi) 
{ 
  // elem_q: elementary charge.
  // mElc: electron mass.
  // momsElc: m0, m1, m2par (and m2perp, but not used) moments of electrons.
  // mIon: ion mass.
  // momsIon: m0, m1, m2par (and m2perp, but not used) moments of ions.
  // phi: electrostatic potential.

  double phiNodal[8];
  phiNodal[0] = -(1.837117307087383*phi[7])+1.060660171779821*phi[6]+1.060660171779821*phi[5]+1.060660171779821*phi[4]-0.6123724356957944*phi[3]-0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[1] = 1.837117307087383*phi[7]+1.060660171779821*phi[6]-1.060660171779821*phi[5]-1.060660171779821*phi[4]-0.6123724356957944*phi[3]-0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[2] = 1.837117307087383*phi[7]-1.060660171779821*phi[6]+1.060660171779821*phi[5]-1.060660171779821*phi[4]-0.6123724356957944*phi[3]+0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[3] = -(1.837117307087383*phi[7])-1.060660171779821*phi[6]-1.060660171779821*phi[5]+1.060660171779821*phi[4]-0.6123724356957944*phi[3]+0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[4] = 1.837117307087383*phi[7]-1.060660171779821*phi[6]-1.060660171779821*phi[5]+1.060660171779821*phi[4]+0.6123724356957944*phi[3]-0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[5] = -(1.837117307087383*phi[7])-1.060660171779821*phi[6]+1.060660171779821*phi[5]-1.060660171779821*phi[4]+0.6123724356957944*phi[3]-0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[6] = -(1.837117307087383*phi[7])+1.060660171779821*phi[6]-1.060660171779821*phi[5]-1.060660171779821*phi[4]+0.6123724356957944*phi[3]+0.6123724356957944*phi[2]-0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 
  phiNodal[7] = 1.837117307087383*phi[7]+1.060660171779821*phi[6]+1.060660171779821*phi[5]+1.060660171779821*phi[4]+0.6123724356957944*phi[3]+0.6123724356957944*phi[2]+0.6123724356957944*phi[1]+0.3535533905932737*phi[0]; 

  const double *m0Elc = &momsElc[0];
  const double *m0Ion = &momsIon[0];
  const double *m1Elc = &momsElc[8];
  const double *m1Ion = &momsIon[8];
  const double *m2parElc = &momsElc[16];
  const double *m2parIon = &momsIon[16];

  double m0eSurfNodal[4];
  double m0iSurfNodal[4];
  double m1eSurfNodal[4];
  double m1iSurfNodal[4];
  double m2pareSurfNodal[4];
  double m2pariSurfNodal[4];
  double phiWallNodal[4];
  m0eSurfNodal[0] = 1.837117307087383*m0Elc[7]-1.060660171779821*m0Elc[6]-1.060660171779821*m0Elc[5]+1.060660171779821*m0Elc[4]+0.6123724356957944*m0Elc[3]-0.6123724356957944*m0Elc[2]-0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[1] = -(1.837117307087383*m0Elc[7])-1.060660171779821*m0Elc[6]+1.060660171779821*m0Elc[5]-1.060660171779821*m0Elc[4]+0.6123724356957944*m0Elc[3]-0.6123724356957944*m0Elc[2]+0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[2] = -(1.837117307087383*m0Elc[7])+1.060660171779821*m0Elc[6]-1.060660171779821*m0Elc[5]-1.060660171779821*m0Elc[4]+0.6123724356957944*m0Elc[3]+0.6123724356957944*m0Elc[2]-0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0eSurfNodal[3] = 1.837117307087383*m0Elc[7]+1.060660171779821*m0Elc[6]+1.060660171779821*m0Elc[5]+1.060660171779821*m0Elc[4]+0.6123724356957944*m0Elc[3]+0.6123724356957944*m0Elc[2]+0.6123724356957944*m0Elc[1]+0.3535533905932737*m0Elc[0]; 
  m0iSurfNodal[0] = 1.837117307087383*m0Ion[7]-1.060660171779821*m0Ion[6]-1.060660171779821*m0Ion[5]+1.060660171779821*m0Ion[4]+0.6123724356957944*m0Ion[3]-0.6123724356957944*m0Ion[2]-0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[1] = -(1.837117307087383*m0Ion[7])-1.060660171779821*m0Ion[6]+1.060660171779821*m0Ion[5]-1.060660171779821*m0Ion[4]+0.6123724356957944*m0Ion[3]-0.6123724356957944*m0Ion[2]+0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[2] = -(1.837117307087383*m0Ion[7])+1.060660171779821*m0Ion[6]-1.060660171779821*m0Ion[5]-1.060660171779821*m0Ion[4]+0.6123724356957944*m0Ion[3]+0.6123724356957944*m0Ion[2]-0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m0iSurfNodal[3] = 1.837117307087383*m0Ion[7]+1.060660171779821*m0Ion[6]+1.060660171779821*m0Ion[5]+1.060660171779821*m0Ion[4]+0.6123724356957944*m0Ion[3]+0.6123724356957944*m0Ion[2]+0.6123724356957944*m0Ion[1]+0.3535533905932737*m0Ion[0]; 
  m1eSurfNodal[0] = 1.837117307087383*m1Elc[7]-1.060660171779821*m1Elc[6]-1.060660171779821*m1Elc[5]+1.060660171779821*m1Elc[4]+0.6123724356957944*m1Elc[3]-0.6123724356957944*m1Elc[2]-0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[1] = -(1.837117307087383*m1Elc[7])-1.060660171779821*m1Elc[6]+1.060660171779821*m1Elc[5]-1.060660171779821*m1Elc[4]+0.6123724356957944*m1Elc[3]-0.6123724356957944*m1Elc[2]+0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[2] = -(1.837117307087383*m1Elc[7])+1.060660171779821*m1Elc[6]-1.060660171779821*m1Elc[5]-1.060660171779821*m1Elc[4]+0.6123724356957944*m1Elc[3]+0.6123724356957944*m1Elc[2]-0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1eSurfNodal[3] = 1.837117307087383*m1Elc[7]+1.060660171779821*m1Elc[6]+1.060660171779821*m1Elc[5]+1.060660171779821*m1Elc[4]+0.6123724356957944*m1Elc[3]+0.6123724356957944*m1Elc[2]+0.6123724356957944*m1Elc[1]+0.3535533905932737*m1Elc[0]; 
  m1iSurfNodal[0] = 1.837117307087383*m1Ion[7]-1.060660171779821*m1Ion[6]-1.060660171779821*m1Ion[5]+1.060660171779821*m1Ion[4]+0.6123724356957944*m1Ion[3]-0.6123724356957944*m1Ion[2]-0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[1] = -(1.837117307087383*m1Ion[7])-1.060660171779821*m1Ion[6]+1.060660171779821*m1Ion[5]-1.060660171779821*m1Ion[4]+0.6123724356957944*m1Ion[3]-0.6123724356957944*m1Ion[2]+0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[2] = -(1.837117307087383*m1Ion[7])+1.060660171779821*m1Ion[6]-1.060660171779821*m1Ion[5]-1.060660171779821*m1Ion[4]+0.6123724356957944*m1Ion[3]+0.6123724356957944*m1Ion[2]-0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m1iSurfNodal[3] = 1.837117307087383*m1Ion[7]+1.060660171779821*m1Ion[6]+1.060660171779821*m1Ion[5]+1.060660171779821*m1Ion[4]+0.6123724356957944*m1Ion[3]+0.6123724356957944*m1Ion[2]+0.6123724356957944*m1Ion[1]+0.3535533905932737*m1Ion[0]; 
  m2pareSurfNodal[0] = 1.837117307087383*m2parElc[7]-1.060660171779821*m2parElc[6]-1.060660171779821*m2parElc[5]+1.060660171779821*m2parElc[4]+0.6123724356957944*m2parElc[3]-0.6123724356957944*m2parElc[2]-0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[1] = -(1.837117307087383*m2parElc[7])-1.060660171779821*m2parElc[6]+1.060660171779821*m2parElc[5]-1.060660171779821*m2parElc[4]+0.6123724356957944*m2parElc[3]-0.6123724356957944*m2parElc[2]+0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[2] = -(1.837117307087383*m2parElc[7])+1.060660171779821*m2parElc[6]-1.060660171779821*m2parElc[5]-1.060660171779821*m2parElc[4]+0.6123724356957944*m2parElc[3]+0.6123724356957944*m2parElc[2]-0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pareSurfNodal[3] = 1.837117307087383*m2parElc[7]+1.060660171779821*m2parElc[6]+1.060660171779821*m2parElc[5]+1.060660171779821*m2parElc[4]+0.6123724356957944*m2parElc[3]+0.6123724356957944*m2parElc[2]+0.6123724356957944*m2parElc[1]+0.3535533905932737*m2parElc[0]; 
  m2pariSurfNodal[0] = 1.837117307087383*m2parIon[7]-1.060660171779821*m2parIon[6]-1.060660171779821*m2parIon[5]+1.060660171779821*m2parIon[4]+0.6123724356957944*m2parIon[3]-0.6123724356957944*m2parIon[2]-0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[1] = -(1.837117307087383*m2parIon[7])-1.060660171779821*m2parIon[6]+1.060660171779821*m2parIon[5]-1.060660171779821*m2parIon[4]+0.6123724356957944*m2parIon[3]-0.6123724356957944*m2parIon[2]+0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[2] = -(1.837117307087383*m2parIon[7])+1.060660171779821*m2parIon[6]-1.060660171779821*m2parIon[5]-1.060660171779821*m2parIon[4]+0.6123724356957944*m2parIon[3]+0.6123724356957944*m2parIon[2]-0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  m2pariSurfNodal[3] = 1.837117307087383*m2parIon[7]+1.060660171779821*m2parIon[6]+1.060660171779821*m2parIon[5]+1.060660171779821*m2parIon[4]+0.6123724356957944*m2parIon[3]+0.6123724356957944*m2parIon[2]+0.6123724356957944*m2parIon[1]+0.3535533905932737*m2parIon[0]; 
  phiWallNodal[0] = 1.5*phiWall[3]-0.8660254037844386*phiWall[2]-0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[1] = -(1.5*phiWall[3])-0.8660254037844386*phiWall[2]+0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[2] = -(1.5*phiWall[3])+0.8660254037844386*phiWall[2]-0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 
  phiWallNodal[3] = 1.5*phiWall[3]+0.8660254037844386*phiWall[2]+0.8660254037844386*phiWall[1]+0.5*phiWall[0]; 

  double upar_e = m1eSurfNodal[0]/m0eSurfNodal[0];
  double upar_i = m1iSurfNodal[0]/m0iSurfNodal[0];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[0]*mElc*upar_e-1.0*m2pareSurfNodal[0]*mElc))/m0eSurfNodal[0]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[0]*mIon*upar_i-1.0*m2pariSurfNodal[0]*mIon))/m0iSurfNodal[0]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 0;
  else
    Delta_phi_r = 0.0;

  phiNodal[4] = fmax(phiNodal[4] + Delta_phi_r, phi_wallNodal[0];

  double upar_e = m1eSurfNodal[1]/m0eSurfNodal[1];
  double upar_i = m1iSurfNodal[1]/m0iSurfNodal[1];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[1]*mElc*upar_e-1.0*m2pareSurfNodal[1]*mElc))/m0eSurfNodal[1]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[1]*mIon*upar_i-1.0*m2pariSurfNodal[1]*mIon))/m0iSurfNodal[1]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 1;
  else
    Delta_phi_r = 0.0;

  phiNodal[5] = fmax(phiNodal[5] + Delta_phi_r, phi_wallNodal[1];

  double upar_e = m1eSurfNodal[2]/m0eSurfNodal[2];
  double upar_i = m1iSurfNodal[2]/m0iSurfNodal[2];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[2]*mElc*upar_e-1.0*m2pareSurfNodal[2]*mElc))/m0eSurfNodal[2]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[2]*mIon*upar_i-1.0*m2pariSurfNodal[2]*mIon))/m0iSurfNodal[2]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 2;
  else
    Delta_phi_r = 0.0;

  phiNodal[6] = fmax(phiNodal[6] + Delta_phi_r, phi_wallNodal[2];

  double upar_e = m1eSurfNodal[3]/m0eSurfNodal[3];
  double upar_i = m1iSurfNodal[3]/m0iSurfNodal[3];

  double Tpar_e = fmax(0.0, -((1.0*(m1eSurfNodal[3]*mElc*upar_e-1.0*m2pareSurfNodal[3]*mElc))/m0eSurfNodal[3]));
  double Tpar_i = fmax(0.0, -((1.0*(m1iSurfNodal[3]*mIon*upar_i-1.0*m2pariSurfNodal[3]*mIon))/m0iSurfNodal[3]));

  double c_s = sqrt((3.0*Tpar_i+Tpar_e)/mIon);
  double Delta_phi_r;
  if (c_s > 0.0)
    Delta_phi_r = 3;
  else
    Delta_phi_r = 0.0;

  phiNodal[7] = fmax(phiNodal[7] + Delta_phi_r, phi_wallNodal[3];

  phi[0] = 0.3535533905932737*phiNodal[7]+0.3535533905932737*phiNodal[6]+0.3535533905932737*phiNodal[5]+0.3535533905932737*phiNodal[4]+0.3535533905932737*phiNodal[3]+0.3535533905932737*phiNodal[2]+0.3535533905932737*phiNodal[1]+0.3535533905932737*phiNodal[0]; 
  phi[1] = 0.20412414523193148*phiNodal[7]-0.20412414523193148*phiNodal[6]+0.20412414523193148*phiNodal[5]-0.20412414523193148*phiNodal[4]+0.20412414523193148*phiNodal[3]-0.20412414523193148*phiNodal[2]+0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[2] = 0.20412414523193148*phiNodal[7]+0.20412414523193148*phiNodal[6]-0.20412414523193148*phiNodal[5]-0.20412414523193148*phiNodal[4]+0.20412414523193148*phiNodal[3]+0.20412414523193148*phiNodal[2]-0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[3] = 0.20412414523193148*phiNodal[7]+0.20412414523193148*phiNodal[6]+0.20412414523193148*phiNodal[5]+0.20412414523193148*phiNodal[4]-0.20412414523193148*phiNodal[3]-0.20412414523193148*phiNodal[2]-0.20412414523193148*phiNodal[1]-0.20412414523193148*phiNodal[0]; 
  phi[4] = 0.11785113019775789*phiNodal[7]-0.11785113019775789*phiNodal[6]-0.11785113019775789*phiNodal[5]+0.11785113019775789*phiNodal[4]+0.11785113019775789*phiNodal[3]-0.11785113019775789*phiNodal[2]-0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[5] = 0.11785113019775789*phiNodal[7]-0.11785113019775789*phiNodal[6]+0.11785113019775789*phiNodal[5]-0.11785113019775789*phiNodal[4]-0.11785113019775789*phiNodal[3]+0.11785113019775789*phiNodal[2]-0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[6] = 0.11785113019775789*phiNodal[7]+0.11785113019775789*phiNodal[6]-0.11785113019775789*phiNodal[5]-0.11785113019775789*phiNodal[4]-0.11785113019775789*phiNodal[3]-0.11785113019775789*phiNodal[2]+0.11785113019775789*phiNodal[1]+0.11785113019775789*phiNodal[0]; 
  phi[7] = 0.06804138174397717*phiNodal[7]-0.06804138174397717*phiNodal[6]-0.06804138174397717*phiNodal[5]+0.06804138174397717*phiNodal[4]-0.06804138174397717*phiNodal[3]+0.06804138174397717*phiNodal[2]+0.06804138174397717*phiNodal[1]-0.06804138174397717*phiNodal[0]; 
 
}
